<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object</title>
    <style>
        canvas {
            background-color: white;
            border-color: black;
            border-style: solid;
        }
    </style>
</head>

<body>
    <canvas width="500" height="500" id="myCanvas"></canvas>

    <script>
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");
        window.requestAnimationFrame = (function () {
            return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                function (callback) {
                    window.setTimeout(callback, 15);
                };
        }());

        var pause = false;
        var score = 0;

        // Cuerpo de objeto
        class objectBody {
            constructor(x, y, width, height, colour) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.colour = colour;
            }

            // Se instancia la función "detectCollision" dentro de la clase cuerpo de objeto
            detectCollision(object) {
                return !!(this.x < object.x + object.width &&
                    this.x + this.width > object.x &&
                    this.y < object.y + object.height &&
                    this.y + this.height > object.y);
            }

            print() {
                ctx.fillStyle = this.colour;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        };

        // Declaración de los objetos
        var square = new objectBody(225, 225, 50, 50); // Se crea el objeto square apartir de la clase "Cuerpo de objeto"
        square.direction = 0; // Se agregan atributos unicos al objeto square
        square.speed = 5;
        square.getRandomRGBA = function () { // Se agrega una función unica para el objeto square
            const red = Math.floor(Math.random() * 256);
            const green = Math.floor(Math.random() * 256);
            const blue = Math.floor(Math.random() * 256);
            const alpha = 0.5;
            ctx.fillStyle = this.colour = `rgba(${red}, ${green}, ${blue}, ${alpha})`;
        }

        var food = new objectBody(235, 25, 25, 25, 'black'); // Se crea el objecto food apartir de la clase "Cuerpo de objeto"

        var wall = new objectBody(75, 375, 350, 25, 'gray'); // Se crea el objecto wall apartir de la clase "Cuerpo de objeto"
        var wall2 = new objectBody(75, 100, 350, 25, 'gray');

        document.addEventListener("keydown", (e) => {
            switch (e.key) {
                case "p":
                    pause = !pause;
                    break;

                case "Escape":
                    pause = !pause;
                    break;
            }

            if (!pause) {
                switch (e.key) {
                    case "w":
                        square.direction = 1;
                        break;

                    case "s":
                        square.direction = 2;
                        break;

                    case "d":
                        square.direction = 3;
                        break;

                    case "a":
                        square.direction = 4;
                        break;

                    case "ArrowUp":
                        square.speed += 5;
                        break;

                    case "ArrowDown":
                        if (square.speed > 5) {
                            square.speed -= 5;
                        }
                        break;
                }
            }
        })

        function update() {
            if (!pause) {
                switch (square.direction) {
                    case 1:
                        square.y -= square.speed;
                        if (square.y < -50) {
                            square.y = 500;
                        }
                        break;

                    case 2:
                        square.y += square.speed;
                        if (square.y > 500) {
                            square.y = -50;
                        }
                        break;

                    case 3:
                        square.x += square.speed;
                        if (square.x > 500) {
                            square.x = -50;
                        }
                        break;

                    case 4:
                        square.x -= square.speed;
                        if (square.x < -50) {
                            square.x = 500;
                        }
                        break;
                }
            }

            // Se llama la función "detectCollision" instanciada dentro del "Cuerpo de Objeto"
            if (square.detectCollision(food) || food.detectCollision(wall) || food.detectCollision(wall2)) {
                food.x = Math.floor(Math.random() * 476);
                food.y = Math.floor(Math.random() * 476);
                if (!food.detectCollision(wall)) {
                    score += 10;
                }
            }

            if (square.detectCollision(wall) || square.detectCollision(wall2)) {
                switch (square.direction) {
                    case 1:
                        square.y += square.speed;
                        square.direction = 0;
                        break;

                    case 2:
                        square.y -= square.speed;
                        square.direction = 0;
                        break;

                    case 3:
                        square.x -= square.speed;
                        square.direction = 0;
                        break;

                    case 4:
                        square.x += square.speed;
                        square.direction = 0;
                        break;
                }
            }

            frame();
            window.requestAnimationFrame(update);
        }

        function frame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (!pause) {
                square.getRandomRGBA(); // Se llama la función unica dentro del objeto square
            }
            square.print(); // Se llama la función "print" instanciada en la clase "Cuerpo de Objeto"

            food.print();

            wall.print();
            wall2.print();

            ctx.font = '15px Arial';
            ctx.fillText("Score: " + score, 10, 20);

            if (pause) {
                ctx.fillStyle = 'rgba(128, 128, 128, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                var text = "Pause";

                // Mide la longitud del texto
                var textWidth = ctx.measureText(text).width;

                // Calcula las coordenadas para centrar el texto
                var x = (canvas.width - textWidth) / 2;
                var y = (canvas.height + 25) / 2;

                ctx.font = '48px Arial';
                ctx.fillStyle = 'black';
                ctx.fillText(text, x, y);
            }
        }
        update();
    </script>
</body>

</html>